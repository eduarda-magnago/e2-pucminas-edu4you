@model edu_for_you.Models.Topico
@{
    ViewData["Title"] = "Detalhes do Tópico";
    var postagemPrincipal = ViewBag.PostagemPrincipal as edu_for_you.Models.Postagem;
    var respostas = ViewBag.Respostas as List<edu_for_you.Models.Postagem>;
}

<style>
    .btn-save {
        background-color: #769AC1;
        color: white;
        padding: 10px 24px;
        border-radius: 8px;
        font-weight: 400;
        font-size: 14px;
        border: none;
        transition: background-color 0.3s ease;
    }

    .btn-save:hover {
        background-color: #5c7aa1;
        color: #ffffff;
    }

    .btn-yellow {
        background-color: rgba(250, 185, 0, 0.85);
        color: white;
        padding: 10px 24px;
        border-radius: 8px;
        font-weight: 400;
        font-size: 14px;
        border: none;
        transition: background-color 0.3s ease;
        text-decoration: none;
    }

    .btn-yellow:hover {
        background-color: rgba(250, 185, 0, 1);
        color: #ffffff;
    }

    .botoes-form {
        margin-top: 15px;
    }
</style>

<h2>@Model.Titulo</h2>
<p><strong>Autor:</strong> @Model.Autor</p>
<p><strong>Data de Criação:</strong> @Model.DataCriacao.ToString("dd/MM/yyyy HH:mm")</p>
<p><strong>Curso:</strong> @Model.Forum?.Curso?.nome</p>

<hr />
<h3>Postagem Principal</h3>

@if (postagemPrincipal != null)
{
    <div class="postagem p-3 mb-4 border rounded bg-light">
        <strong>@postagemPrincipal.Usuario?.nome</strong> - @postagemPrincipal.data_criacao.ToString("g")
        <p>@postagemPrincipal.conteudo</p>
    </div>
}
else
{
    <p><em>Este tópico ainda não possui uma postagem principal.</em></p>
}

<hr />
<h3>Respostas</h3>

@if (respostas != null && respostas.Any())
{
    foreach (var r in respostas)
    {
        <div class="resposta p-3 mb-3 border rounded">
            <strong>@r.Usuario?.nome</strong> - @r.data_criacao.ToString("g")
            <p>@r.conteudo</p>
        </div>
    }
}
else
{
    <p><em>Nenhuma resposta ainda.</em></p>
}

<hr />
<h3>Responder ao Tópico</h3>

@if (postagemPrincipal != null)
{
    <form asp-controller="Postagem" asp-action="Create" method="post" class="mt-3">
        <input type="hidden" name="postagem_pai_id" value="@postagemPrincipal.id" />
        <input type="hidden" name="id_curso" value="@Model.Forum.Curso.id" />

        <div class="form-group mb-2">
            <label for="titulo">Título</label>
            <input type="text" name="titulo" class="form-control" required />
        </div>

        <div class="form-group mb-2">
            <label for="conteudo">Conteúdo</label>
            <textarea name="conteudo" class="form-control" rows="4" required></textarea>
        </div>
        <a asp-action="Details" asp-controller="Forum" asp-route-id="@Model.Forum.Id" class="btn-yellow botoes-form">Voltar para o Fórum</a>
        <button type="submit" class="btn-save botoes-form">Postar Resposta</button> 
    </form>
}
else
{
    <p><strong>Erro:</strong> não foi possível encontrar a postagem principal para este tópico.</p>
}

<hr />
